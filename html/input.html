<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Server Details Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script> <!-- FileSaver.js CDN -->
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    form {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      margin: 0 auto;
    }
    h3 {
      color: #444;
      margin-top: 20px;
    }
    label {
      display: block;
      margin: 8px 0 5px;
    }
    input[type="text"],
    input[type="password"],
    input[type="number"],
    input[type="checkbox"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    input[type="checkbox"] {
      width: auto;
      margin-top: 5px;
    }
    .vm {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    .vm h4 {
      color: #333;
    }
    button {
      background-color: #5c6bc0;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #3f51b5;
    }
    input[type="submit"] {
      background-color: #4caf50;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    input[type="submit"]:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

<h2>Enter Server Details</h2>
<form method="post" id="serverForm">
  <h3>Basic Server Information</h3>
  <label for="paragon_version">Paragon Version:</label>
  <input type="text" name="paragon_version" value="24.1" required>
  
  <label for="server_ip">Server IP:</label>
  <input type="text" name="server_ip" value="10.219.94.137" required>
  
  <label for="server_username">Server Username:</label>
  <input type="text" name="server_username" value="root" required>
  
  <label for="server_password">Server Password:</label>
  <input type="password" name="server_password" value="root1234" required>
  
  <label for="ingress_ip">Ingress IP:</label>
  <input type="text" name="ingress_ip" value="192.168.1.100" required>
  
  <label for="cluster_name">Cluster Name:</label>
  <input type="text" name="cluster_name" value="paragon-cluster" required>
  
  <label for="ingresscontroller">Ingress Controller:</label>
  <input type="text" name="ingresscontroller">
  
  <label for="insightsip">Insights IP:</label>
  <input type="text" name="insightsip">
  
  <label for="snmp">SNMP:</label>
  <input type="text" name="snmp">
  
  <label for="pathfinder">Pathfinder:</label>
  <input type="text" name="pathfinder">
  
  <label for="use_netflowd">Use Netflowd:</label>
  <input type="checkbox" name="use_netflowd" checked>
  
  <label for="pce_server">PCE Server:</label>
  <input type="text" name="pce_server">
  
  <label for="ntp">NTP:</label>
  <input type="text" name="ntp" value="time.nist.gov" required>
  
  <label for="md5_bgp">MD5 BGP:</label>
  <input type="text" name="md5_bgp">
  
  <label for="md5_pce">MD5 PCE:</label>
  <input type="text" name="md5_pce">
  
  <label for="bgp_asn">BGP ASN:</label>
  <input type="text" name="bgp_asn">

  <h3>Virtual Machines</h3>
  <div id="vms"></div>
  <button type="button" onclick="addVM()">Add VM</button><br><br>

  <input type="submit" value="Submit">
</form>

<script>
  let vmCount = 0;
  const vms = [];

  function addVM() {
    vmCount++;

    const vmDiv = document.createElement('div');
    vmDiv.classList.add('vm');
    vmDiv.innerHTML = `
      <h4>VM ${vmCount}</h4>
      <label for="hostname_${vmCount}">Hostname:</label>
      <input type="text" name="vms[${vmCount - 1}][hostname]" required><br>
      
      <label for="ip_address_${vmCount}">IP Address:</label>
      <input type="text" name="vms[${vmCount - 1}][ip_address]" required><br>
      
      <label for="user_${vmCount}">User:</label>
      <input type="text" name="vms[${vmCount - 1}][user]" required><br>
      
      <label for="password_${vmCount}">Password:</label>
      <input type="password" name="vms[${vmCount - 1}][password]" required><br>
      
      <label for="is_storage_node_${vmCount}">Is Storage Node:</label>
      <input type="checkbox" name="vms[${vmCount - 1}][is_storage_node]"><br>
      
      <label for="vm_type_${vmCount}">VM Type:</label>
      <input type="text" name="vms[${vmCount - 1}][vm_type]" required><br>
      
      <label for="os_${vmCount}">OS:</label>
      <input type="text" name="vms[${vmCount - 1}][os]" required><br>
      
      <label for="cpu_cores_${vmCount}">CPU Cores:</label>
      <input type="number" name="vms[${vmCount - 1}][cpu_cores]" required><br>
      
      <label for="ram_gb_${vmCount}">RAM (GB):</label>
      <input type="number" name="vms[${vmCount - 1}][ram_gb]" required><br>
      
      <label for="ssh_enabled_${vmCount}">SSH Enabled:</label>
      <input type="checkbox" name="vms[${vmCount - 1}][ssh_enabled]"><br>
    `;

    document.getElementById('vms').appendChild(vmDiv);
  }

  document.getElementById('serverForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent form submission

    const formData = new FormData(this);
    const data = {};

    // Collect basic form data
    formData.forEach((value, key) => {
      if (key.startsWith('vms')) {
        // Collect VM data into vms array
        const vmKey = key.split('[')[1].split(']')[0];
        if (!vms[vmKey]) {
          vms[vmKey] = {};
        }
        const field = key.split('[')[2].split(']')[0];
        vms[vmKey][field] = value;
      } else {
        data[key] = value;
      }
    });

    data.vms = Object.values(vms); // Assign the array of VMs to the main data object

    // Convert to JSON
    const jsonData = JSON.stringify(data, null, 2);

    // Trigger download of the JSON data
    const blob = new Blob([jsonData], { type: 'application/json' });
    saveAs(blob, 'server_data.json'); // FileSaver.js function to trigger download
  });
</script>

</body>
</html>
